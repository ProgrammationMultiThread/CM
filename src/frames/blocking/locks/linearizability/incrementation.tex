% SPDX-License-Identifier: CC-BY-SA-4.0
% Author: Matthieu Perrin
% Part: 
% Section: 
% Sub-section: 
% Frame: 

\begingroup

\begin{frame}{Algorithmes d'incrémentation}
  \begin{block}{Algorithme bloquant}
    \begin{itemize}
    \item Point de linéarisation n'importe où en section critique
    \end{itemize}
    \centering
    \scalebox{.6}{\begin{tikzpicture}
        \draw[exampleColor, fill=exampleColor!20, rounded corners] (0.6,0.6)  rectangle (10.1,1.4);
        \draw[alertColor, fill=alertColor!20, rounded corners] (0.6,-0.4) rectangle (5.8,0.4);
        
        \draw[structure, -latex] (0,2) node[left]{$counter$} +(.2,.15) node{$0$} +(0,0) -- (10.5,2);
        \draw[exampleColor,-latex] (0,1) node[left]{$t1$} -- (10.5,1);
        \draw[alertColor, -latex] (0,0) node[left]{$t2$} -- (10.5,0);
        \draw[structure, -latex] (0,-1   ) node[left]{\scriptsize $value$} +(.15,.12) node{\scriptsize $0$} +(0,0) -- (10.5,-1   );
        \draw[structure, -latex] (0,-1.25) node[left]{\scriptsize $lock$}  +(0,0) -- (10.5,-1.25);
        
        \draw[exampleColor, thick, densely dotted] (7.9 ,1.4) node{$\bullet$} -- (7.9 ,2) node{$\bullet$} ++(0,.15) node[left]{\footnotesize$increment()$} node[right]{\footnotesize$2$}; 
        \draw[alertColor,   thick, densely dotted] (3.6 ,0.4) node{$\bullet$} -- (3.6 ,2) node{$\bullet$} ++(0,.15) node[left]{\footnotesize$increment()$} node[right]{\footnotesize$1$}; 
        
        \draw[alertColor,   ultra thick] (1.2 ,-1.25) -- (5.0 ,-1.25) ; 
        \draw[exampleColor, ultra thick] (5.75 ,-1.25) -- (9.3 ,-1.25) ; 
        
        
        \draw[structure, thick, densely dotted] (5.75 ,1) -- (5.75 ,-1.25) node{$\bullet$} +(.15,.12) ; 
        \draw[structure, thick, densely dotted] (6.7 ,1) -- (6.7 ,-1   ) node{$\bullet$} +(.15,.12) node{\scriptsize $1$}; 
        \draw[structure, thick, densely dotted] (7.9 ,1) -- (7.9 ,-1   ) node{$\bullet$} +(.15,.12) node{\scriptsize $2$}; 
        \draw[structure, thick, densely dotted] (9.3 ,1) -- (9.3 ,-1.25) node{$\bullet$} +(.15,.12) ; 
        \draw[structure, thick, densely dotted] (1.2 ,0) -- (1.2 ,-1.25) node{$\bullet$} +(.15,.12) ; 
        \draw[structure, thick, densely dotted] (2.4 ,0) -- (2.4 ,-1   ) node{$\bullet$} +(.15,.12) node{\scriptsize $0$}; 
        \draw[structure, thick, densely dotted] (3.6 ,0) -- (3.6 ,-1   ) node{$\bullet$} +(.15,.12) node{\scriptsize $1$}; 
        \draw[structure, thick, densely dotted] (5.0 ,0) -- (5.0 ,-1.25) node{$\bullet$} +(.15,.12) ; 
        
        
        \draw[structure, fill=structure!20, rounded corners] (3.0 ,1)  +(-2.3,-0.3) rectangle +(3.0,0.3) +(0,0) node{$lock()$};
        \draw[structure, fill=structure!20, rounded corners] (6.7 ,1)  +(-0.5,-0.3) rectangle +(0.5,0.3) +(0,0) node{$get()$};
        \draw[structure, fill=structure!20, rounded corners] (7.9 ,1)  +(-0.5,-0.3) rectangle +(0.5,0.3) +(0,0) node{$set(2)$};
        \draw[structure, fill=structure!20, rounded corners] (9.3 ,1)  +(-0.7,-0.3) rectangle +(0.7,0.3) +(0,0) node{$unlock()$};
        \draw[structure, fill=structure!20, rounded corners] (1.2 ,0)  +(-0.5,-0.3) rectangle +(0.5,0.3) +(0,0) node{$lock()$};
        \draw[structure, fill=structure!20, rounded corners] (2.4 ,0)  +(-0.5,-0.3) rectangle +(0.5,0.3) +(0,0) node{$get()$};
        \draw[structure, fill=structure!20, rounded corners] (3.6 ,0)  +(-0.5,-0.3) rectangle +(0.5,0.3) +(0,0) node{$set(1)$};
        \draw[structure, fill=structure!20, rounded corners] (5.0 ,0)  +(-0.7,-0.3) rectangle +(0.7,0.3) +(0,0) node{$unlock()$};
        
        
    \end{tikzpicture}}
  \end{block}
  \begin{block}{Algorithme non-bloquant}
    \begin{itemize}
    \item Point de linéarisation sur la dernière instruction \lstinline{compareAndSet} 
    \end{itemize}
    \centering
    \scalebox{.6}{\begin{tikzpicture}
        \draw[exampleColor, fill=exampleColor!20, rounded corners] (0.6,0.6)  rectangle (10.1,1.4);
        \draw[alertColor, fill=alertColor!20, rounded corners] (0.6,-0.4) rectangle (5.8,0.4);
        
        \draw[structure, -latex] (0,2) node[left]{$counter$} +(.2,.15) node{$0$} +(0,0) -- (10.5,2);
        \draw[exampleColor,-latex] (0,1) node[left]{$t1$} -- (10.5,1);
        \draw[alertColor, -latex] (0,0) node[left]{$t2$} -- (10.5,0);
        \draw[structure, -latex] (0,-1   ) node[left]{\scriptsize $value$} +(.15,.12) node{\scriptsize $0$} +(0,0) -- (10.5,-1   );
        
        \draw[exampleColor, thick, densely dotted] (8.0 ,1.4) node{$\bullet$} -- (8.0 ,2) node{$\bullet$} ++(0,.15) node[left]{\footnotesize$increment()$} node[right]{\footnotesize$2$}; 
        \draw[alertColor,   thick, densely dotted] (4.0 ,0.4) node{$\bullet$} -- (4.0 ,2) node{$\bullet$} ++(0,.15) node[left]{\footnotesize$increment()$} node[right]{\footnotesize$1$};  
        
        \draw[structure, thick, densely dotted] (8.0 ,1) -- (8.0 ,-1) node{$\bullet$} +(.15,.12) node{\scriptsize $2$}; 
        \draw[structure, thick, densely dotted] (4.0 ,0) -- (4.0 ,-1) node{$\bullet$} +(.15,.12) node{\scriptsize $1$}; 
        \draw[structure, thick, densely dotted] (3.0 ,1) -- (3.0 ,-1) node{$\bullet$};
        \draw[structure, thick, densely dotted] (5.0 ,1) -- (5.0 ,-1) node{$\bullet$};
        \draw[structure, thick, densely dotted] (6.5 ,1) -- (6.5 ,-1) node{$\bullet$};
        \draw[structure, thick, densely dotted] (2.0 ,0) -- (2.0 ,-1) node{$\bullet$};


        \draw[structure, fill=structure!20, rounded corners] (3.0 ,1)  +(-0.50,-0.3) rectangle +(0.50,0.3) +(0,0) node{$get()$};
        \draw[structure, fill=structure!20, rounded corners] (5.0 ,1)  +(-0.75,-0.3) rectangle +(0.75,0.3) +(0,0) node{$cas(0, 1)$};
        \draw[structure, fill=structure!20, rounded corners] (6.5 ,1)  +(-0.50,-0.3) rectangle +(0.50,0.3) +(0,0) node{$get()$};
        \draw[structure, fill=structure!20, rounded corners] (8.0 ,1)  +(-0.75,-0.3) rectangle +(0.75,0.3) +(0,0) node{$cas(1, 2)$};
        \draw[structure, fill=structure!20, rounded corners] (2.0 ,0)  +(-0.50,-0.3) rectangle +(0.50,0.3) +(0,0) node{$get()$};
        \draw[structure, fill=structure!20, rounded corners] (4.0 ,0)  +(-0.75,-0.3) rectangle +(0.75,0.3) +(0,0) node{$cas(0, 1)$};
        
    \end{tikzpicture}}
  \end{block}
\end{frame}

\endgroup
\endinput
