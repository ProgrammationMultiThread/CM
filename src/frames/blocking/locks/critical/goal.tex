% SPDX-License-Identifier: CC-BY-SA-4.0
% Author: Matthieu Perrin
% Part: 
% Section: 
% Sub-section: 
% Frame: 

\begingroup

\begin{frame}[fragile]{Ce que l'on voudrait}

  \begin{block}{Rappel : exécution séquentiellement cohérente}
    Le résultat observable d'une exécution est le même que celui d'un entrelacement de l'ordre ``happened before''
  \end{block}

  \begin{center}
    \begin{tikzpicture}
      \draw (8.5, 4.25) node{\begin{minipage}{4cm}\begin{lstlisting}[gobble=12]
            interface Counter {
              void increment() ;
              int get() ;
            }
      \end{lstlisting}\end{minipage}};
      \draw[fill=black!10, ultra thin, rounded corners]
      (1.5,5)    +(-.6,-.35) rectangle +(1.1,.35);
      \draw[exampleColor]
      (1.5,5)  +(0,.2)   node[left]{\tiny$t1$}    node {\tiny:} node[right]{\tiny$\mathit{increment()}$};
      \draw[alertColor]
      (1.5,5)  +(0,0)    node[left]{\tiny$t2$}    node {\tiny:} node[right]{\tiny$\mathit{increment()}$};
      \draw
      (1.5,5)  +(0,-.2)  node[left]{\tiny$result$} node {\tiny=} node[right]{\tiny 0};

      \draw[fill=black!10, ultra thin, rounded corners]
      (4,5)    +(-.6,-.35) rectangle +(1.1,.35);
      \draw
      (4,5)  +(0,.2)   node[left]{\tiny$t1$}    node {\tiny:} node[right]{\tiny$\textsc{terminated}$};
      \draw[alertColor]
      (4,5)  +(0,0)    node[left]{\tiny$t2$}    node {\tiny:} node[right]{\tiny$\mathit{increment()}$};
      \draw
      (4,5)  +(0,-.2)  node[left]{\tiny$result$} node {\tiny=} node[right]{\tiny 1};

      %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

      \draw[fill=black!10, ultra thin, rounded corners]
      (1.5,3.5)    +(-.6,-.35) rectangle +(1.1,.35);
      \draw[exampleColor]
      (1.5,3.5)  +(0,.2)   node[left]{\tiny$t1$}    node {\tiny:} node[right]{\tiny$\mathit{increment()}$};
      \draw
      (1.5,3.5)  +(0,0)    node[left]{\tiny$t2$}    node {\tiny:} node[right]{\tiny$\textsc{terminated}$};
      \draw
      (1.5,3.5)  +(0,-.2)  node[left]{\tiny$result$} node {\tiny=} node[right]{\tiny 1};

      \draw[structure, fill=structure!10, ultra thin, rounded corners]
      (4,3.5)    +(-.65,-.4) rectangle +(1.15,.4);
      \draw[structure, fill=structure!10, ultra thin, rounded corners]
      (4,3.5)    +(-.6,-.35) rectangle +(1.1,.35);
      \draw
      (4,3.5)  +(0,.2)   node[left]{\tiny$t1$}    node {\tiny:} node[right]{\tiny$\textsc{terminated}$};
      \draw
      (4,3.5)  +(0,0)    node[left]{\tiny$t2$}    node {\tiny:} node[right]{\tiny$\textsc{terminated}$};
      \draw
      (4,3.5)  +(0,-.2)  node[left]{\tiny$result$} node {\tiny=} node[right]{\tiny 2};

      \draw[-latex] (.6,5)  -- (.9,5) ;
      \draw[exampleColor,-latex] (2.6,5)  -- (3.4,5) ;
      \draw[exampleColor,-latex] (2.6,3.5)  -- (3.35,3.5) ;

      \draw[alertColor,-latex] (1.75,4.65)  -- (1.75,3.85) ;
      \draw[alertColor,-latex] (4.25,4.65)  -- (4.25,3.9) ;

    \end{tikzpicture}
  \end{center}

  \begin{block}{Entrelacements possibles}
    \vspace{-2mm}
    \begin{itemize}
    \item ${\color{exampleColor}t_1:increment();~} {\color{alertColor}t_2:increment();~}$ \hspace{5mm} $result=2$
    \item ${\color{alertColor}t_2:increment();~} {\color{exampleColor}t_1:increment();~}$ \hspace{5mm} $result=2$
    \end{itemize}
  \end{block}

  \pause
  \vspace{-1mm}

  \begin{block}{Notion d'atomicité}
    \vspace{-2mm}
    \begin{itemize}
    \item À quelle granularité définit-on les \structure{événements} d'une exécution ?  
    \item \alert{Section critique} : portion de code qui doit être exécutée \structure{atomiquement}
    \end{itemize}
  \end{block}

\end{frame}

\endgroup
\endinput
