% SPDX-License-Identifier: CC-BY-SA-4.0
% Author: Matthieu Perrin
% Part: 
% Section: 
% Sub-section: 
% Frame: 

\begingroup

\begin{frame}[fragile]{Exemple d'exécution}

  \begin{lstlisting}[gobble=4]
    public synchronized void salute(Friend friend) {
      System.out.println(nom + " salutes " + friend.nom);
      friend.answer(this);
    }

    public synchronized void answer(Friend friend) {
      System.out.println(nom + " answers to " + friend.nom);
    }
  \end{lstlisting}
  
  \scalebox{.6}{
    \begin{tikzpicture}

      \draw[alertColor, fill=alertColor!10, rounded corners] (15,5.6) --  (1, 5.6) -- (1,4.4) -- (15,4.4);
      \draw[exampleColor, fill=exampleColor!10, rounded corners] (15,3.6) --  (2.1, 3.6) -- (2.1,2.4) -- (15,2.4);

      \draw[structure ,   -latex] (0,5) node[left]{$T_A$}      -- (16,5);
      \draw[structure,    -latex] (0,3) node[left]{$T_G$}      -- (16,3);

      \draw[alertColor, fill=alertColor!30, rounded corners] (1.1,5.5) rectangle (3.3,4.5);
      \draw[exampleColor, fill=exampleColor!30, rounded corners] (2.2,3.5) rectangle (4.4,2.5);

      \draw[alertColor]   (2.2,5) node{alphonse.lock};
      \draw[exampleColor] (3.3,3) node{gaston.lock};

      \draw[structure, fill=structure!30, rounded corners] (3.4,5.5) rectangle (5.4,4.5);
      \draw[structure, fill=structure!30, rounded corners] (4.5,3.5) rectangle (6.5,2.5);

      \draw[structure] (4.4,5) node{println};
      \draw[structure] (5.5,3) node{println};

      \draw[exampleColor, fill=exampleColor!20, rounded corners] (15,5.5) --  (5.5, 5.5) -- (5.5,4.5) -- (15,4.5);
      \draw[alertColor, fill=alertColor!20, rounded corners] (15,3.5) --  (6.6, 3.5) -- (6.6,2.5) -- (15,2.5);
      
      \draw[exampleColor, fill=exampleColor!30, rounded corners] (15,5.4) --  (5.6, 5.4) -- (5.6,4.6) -- (15,4.6);
      \draw[alertColor, fill=alertColor!30, rounded corners]     (15,3.4) --  (6.7, 3.4) -- (6.7,2.6) -- (15,2.6);

      \draw[exampleColor] (6.7,5) node{gaston.lock};
      \draw[alertColor]   (7.8,3) node{alphonse.lock};
    \end{tikzpicture}
  }

  \begin{alertblock}{À ce point :}
    \begin{itemize}
    \item $t_A$ est bloqué par $t_G$ sur le verrou de \lstinline{gaston}
    \item $t_G$ est bloqué par $t_A$ sur le verrou de \lstinline{alphonse}
    \end{itemize}
  \end{alertblock}
  
\end{frame}

\endgroup
\endinput
