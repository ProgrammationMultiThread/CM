% SPDX-License-Identifier: CC-BY-SA-4.0
% Author: Matthieu Perrin
% Part: 
% Section: 
% Sub-section: 
% Frame: 

\begingroup

\begin{frame}[fragile]{Exemple (sch√©matique) }

  \vspace{-20mm}
  \begin{lstlisting}
    class Future<T> {

      final Callable<T> task;
      (*\Alert{volatile boolean isDone}*) = false;
      (*\Structure{T value}*) = null;

      void init() { // par thread du thread pool
        (*\Structure{value = task.call();}*)
        (*\Alert{isDone = true;}*)
      }

      T get() { // par autre thread
        while( (*\Alert{!isDone}*) );
        return (*\Structure{value;}*)
      }
    }
  \end{lstlisting}

  \onBlock[bottom]{Happens Before}{
    \centering
    \begin{tikzpicture}[x=40mm, y=15mm, anchor=mid]
      \footnotesize
      \node[operation, fill=black!10] (o1) at (1,1) {\lstinline{value = task.call()}};
      \node[operation, fill=black!10] (o2) at (2,1) {\lstinline{isDone = true}};
      \node[operation, fill=black!10] (o3) at (2,0) {\lstinline{while(!isDone)}};
      \node[operation, fill=black!10] (o4) at (3,0) {\lstinline{return value}};

      \path[-latex, structure] (o1) edge node[above]{ordre de} node[below]{programme} (o2);
      \path[-latex, alert]     (o2) edge node[right]{ordre de \\synchronisation}                   (o3);
      \path[-latex, structure] (o3) edge node[above]{ordre de} node[below]{programme} (o4);
    \end{tikzpicture}
  }

\end{frame}

\endgroup
\endinput
